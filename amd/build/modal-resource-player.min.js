define("mod_clearlesson/modal-resource-player",["exports","core_form/modalform","core/str","./utils","./modal-resource-browser"],(function(_exports,_modalform,_str,Utils,ResourceBrowser){var obj,currentPlayerForm;
/**
   * A set of functions to be added to charts tab load-tabs.js.
   * Most of these functions enable modal forms for the adding/deleting of charts or editing existing charts.
   *
   * @module     mod_clearlesson/modal-resource-browser
   * @copyright  2024 Dan Watkins <dwatkins@charitylearning.org>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   * @since      2.9
   */function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modalform=(obj=_modalform)&&obj.__esModule?obj:{default:obj},Utils=_interopRequireWildcard(Utils),ResourceBrowser=_interopRequireWildcard(ResourceBrowser);_exports.init=()=>{document.addEventListener("click",(function(e){var _element$classList,_element$parentElemen,_element$classList2,_element$parentElemen2,_element$classList3,externalref,type,position=1;let element=e.target;if(null!==(_element$classList=element.classList)&&void 0!==_element$classList&&_element$classList.contains("play-icon")||null!==(_element$parentElemen=element.parentElement.classList)&&void 0!==_element$parentElemen&&_element$parentElemen.contains("play-icon")||null!==(_element$classList2=element.classList)&&void 0!==_element$classList2&&_element$classList2.contains("video-player-link")||null!==(_element$parentElemen2=element.parentElement.classList)&&void 0!==_element$parentElemen2&&_element$parentElemen2.contains("video-player-link")){var _element$getAttribute;if(element.classList.contains("mini-player"))return!0;e.preventDefault(),externalref=null!==(_element$getAttribute=element.getAttribute("data-externalref"))&&void 0!==_element$getAttribute?_element$getAttribute:element.parentElement.getAttribute("data-externalref");if(document.getElementsByClassName("modal").length>1){const videoListColumn=element.closest(".video-list-column");if(!videoListColumn)return!1;videoListColumn.hasAttribute("data-playlist")?(position=parseInt(element.closest(".video-card-side").firstElementChild.innerText),externalref=videoListColumn.getAttribute("data-playlist"),type="playlists"):videoListColumn.hasAttribute("data-speaker")?(externalref=videoListColumn.getAttribute("data-speaker"),position=parseInt(element.closest(".has-position").getAttribute("data-position")),type="speakers"):type="play",reRenderResourcePlayer(externalref,position,type)}else openResourcePlayer(externalref)}const isSpeakerLink=null===(_element$classList3=element.classList)||void 0===_element$classList3?void 0:_element$classList3.contains("speaker-link"),isTopicLink=element.classList.contains("topic-tag");if((isSpeakerLink||isTopicLink)&&(e.preventDefault(),isSpeakerLink&&("CLC-Animation"===(externalref=element.getAttribute("data-speakers"))?(type="collections",externalref="Charity-Focused"):type="speakers"),isTopicLink&&(externalref=element.getAttribute("data-externalref"),type="topics"),(isTopicLink||isSpeakerLink)&&(ResourceBrowser.setWaitingCursor(!0,currentPlayerForm,!1),setTimeout((async function(){await ResourceBrowser.loadResourcePageWithFilter(externalref,type),ResourceBrowser.setWaitingCursor(!1,currentPlayerForm,!1),currentPlayerForm.modal.hide()})))),element.closest('button[data-action="select"]')){e.preventDefault();const button=element.closest('button[data-action="select"]'),type=button.getAttribute("data-type"),externalref=button.getAttribute("data-externalref");ResourceBrowser.selectResource(externalref,type)}return!0}))};const openResourcePlayer=externalref=>{const resourceType=document.getElementsByClassName("disabled-looking")[0].getAttribute("data-type");if("play"!==resourceType)return void alert("Resource player is only available for videos in the mod form. Resource selected: "+resourceType);const cmid=document.querySelector('input[name="coursemodule"]').value,courseid=document.querySelector('input[name="course"]').value,url=window.location.href;var titleString,selectString;"playlists"===resourceType&&(titleString=(0,_str.get_string)("playlistviewer","mod_clearlesson"),selectString=(0,_str.get_string)("selectplaylist","mod_clearlesson")),"play"===resourceType&&(titleString=(0,_str.get_string)("videoplayer","mod_clearlesson"),selectString=(0,_str.get_string)("selectvideo","mod_clearlesson")),"speakers"===resourceType&&(titleString=(0,_str.get_string)("speakerviewer","mod_clearlesson"),selectString=(0,_str.get_string)("selectspeaker","mod_clearlesson"));const playerForm=new _modalform.default({formClass:"mod_clearlesson\\forms\\resource_player_form",args:{type:resourceType,cmid:cmid,course:courseid,url:url,externalref:externalref,position:1},modalConfig:{title:titleString,saveButtonText:selectString}});currentPlayerForm=playerForm,playerForm.addEventListener(playerForm.events.LOADED,(async function(){let modalHeight=Math.ceil(.94*window.innerHeight),modalWidth=Math.ceil(.94*window.innerWidth);modalWidth=modalWidth>1800?1800:modalWidth;const modalRootInner=playerForm.modal.getRoot()[0].children[0];modalRootInner.setAttribute("style","width: "+modalWidth+"px;max-width: "+modalWidth+"px;height: "+modalHeight+"px;max-height: "+modalHeight+"px;");let saveString=await selectString,backString=await(0,_str.get_string)("back");Utils.waitForElement(".modal-footer button.btn-primary",modalRootInner,(function(){const saveButton=modalRootInner.querySelector(".modal-footer button.btn-primary");saveButton.innerHTML=saveString,saveButton.setAttribute("data-action","select"),saveButton.setAttribute("data-type",resourceType),saveButton.setAttribute("data-externalref",externalref),saveButton.classList.add("d-block");modalRootInner.querySelector(".modal-footer button.btn-secondary").innerHTML=backString}))})),playerForm.show()},reRenderResourcePlayer=async(externalref,position,type)=>{const formParams={type:type,cmid:document.querySelector('input[name="coursemodule"]').value,course:document.querySelector('input[name="course"]').value,url:window.location.href,externalref:externalref,position:position},serialFormParams=Utils.serialize(formParams),bodyContent=currentPlayerForm.getBody(serialFormParams);await currentPlayerForm.modal.setBodyContent(bodyContent)}}));

//# sourceMappingURL=modal-resource-player.min.js.map