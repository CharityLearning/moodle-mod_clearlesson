{"version":3,"file":"course-page.min.js","sources":["../src/course-page.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A set of functions to be added to charts tab load-tabs.js.\n * Most of these functions enable modal forms for the adding/deleting of charts or editing existing charts.\n *\n * @module     mod_clearlesson/course-page\n * @copyright  2024 Dan Watkins <dwatkins@charitylearning.org>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      2.9\n */\n\nimport ModalForm from 'core_form/modalform';\nimport * as Utils from './utils';\n\nvar player;\n\nexport const init = () => {\n    var position = 1;\n    var coursModuleId, courseid, url;\n    window.openPlayer = (e) => {\n        if (e.target.href.includes('clearlesson')) {\n            e.preventDefault();\n            const elementAncestor = e.target.closest('.activity');\n            coursModuleId = elementAncestor.querySelector('.activityname a')\n                                                .getAttribute('href').split('id=')[1];\n\n            const searchParams = new URLSearchParams(window.location.search);\n            url = e.target.href;\n            courseid = searchParams.get('id');\n\n            var instanceNameElement = elementAncestor.querySelector('.activityname .instancename');\n            const span = instanceNameElement.querySelector('span');\n            if (span) {\n                instanceNameElement.removeChild(span);\n            }\n            const instanceName = instanceNameElement.innerText;\n\n            const playerModal = new ModalForm({\n                formClass: 'mod_clearlesson\\\\forms\\\\incourse_player_form',\n                args: {cmid: coursModuleId, course: courseid, url: url},\n                modalConfig: {title: instanceName},\n            });\n\n            player = playerModal;\n\n            playerModal.addEventListener(playerModal.events.LOADED, function() {\n                // Set the modal to nearly fullscreen size.\n                let modalHeight = Math.ceil(window.innerHeight * 0.94);\n                let modalWidth = Math.ceil(window.innerWidth * 0.94);\n                modalWidth = modalWidth > 1800 ? 1800 : modalWidth;\n                const modalRootInner = playerModal.modal.getRoot()[0].children[0];\n                modalRootInner.setAttribute('style',\n                    'width: ' + modalWidth +\n                    'px;max-width: ' + modalWidth +\n                    'px;height: ' + modalHeight +\n                    'px;max-height: ' + modalHeight + 'px;'\n                );\n            });\n\n            playerModal.show();\n        }\n    };\n\n    document.addEventListener('click', function(e) {\n        const element = e.target;\n        if (element.classList?.contains('play-icon')\n        || element.parentElement.classList?.contains('play-icon')\n        || element.classList?.contains('video-player-link')\n        || element.parentElement.classList?.contains('video-player-link')) {\n            e.preventDefault();\n            position = parseInt(element.closest('.has-position').getAttribute('data-position'));\n            reRenderPlayerModal(position, coursModuleId, courseid, url);\n        }\n    });\n};\n\n/**\n * Open the player modal.\n *\n * @param {Number} position The position of the resource in the list.\n * @param {Number} coursModuleId The course module ID.\n * @param {Number} courseid The course ID.\n * @param {String} url The URL of the resource.\n */\nasync function reRenderPlayerModal(position, coursModuleId, courseid, url) {\n    const formParams = {cmid: coursModuleId, course: courseid, url: url, position: position};\n    const serialFormParams = Utils.serialize(formParams);\n    const bodyContent = player.getBody(serialFormParams);\n    await player.modal.setBodyContent(bodyContent);\n}"],"names":["player","coursModuleId","courseid","url","window","openPlayer","e","target","href","includes","preventDefault","elementAncestor","closest","querySelector","getAttribute","split","searchParams","URLSearchParams","location","search","get","instanceNameElement","span","removeChild","instanceName","innerText","playerModal","ModalForm","formClass","args","cmid","course","modalConfig","title","addEventListener","events","LOADED","modalHeight","Math","ceil","innerHeight","modalWidth","innerWidth","modal","getRoot","children","setAttribute","show","document","element","classList","contains","parentElement","_element$parentElemen","_element$classList2","_element$parentElemen2","position","formParams","serialFormParams","Utils","serialize","bodyContent","getBody","setBodyContent","reRenderPlayerModal","parseInt"],"mappings":"8HA4BIA;;;;;;;;;2kCAEgB,SAEZC,cAAeC,SAAUC,IAC7BC,OAAOC,WAAcC,OACbA,EAAEC,OAAOC,KAAKC,SAAS,eAAgB,CACvCH,EAAEI,uBACIC,gBAAkBL,EAAEC,OAAOK,QAAQ,aACzCX,cAAgBU,gBAAgBE,cAAc,mBACTC,aAAa,QAAQC,MAAM,OAAO,SAEjEC,aAAe,IAAIC,gBAAgBb,OAAOc,SAASC,QACzDhB,IAAMG,EAAEC,OAAOC,KACfN,SAAWc,aAAaI,IAAI,UAExBC,oBAAsBV,gBAAgBE,cAAc,qCAClDS,KAAOD,oBAAoBR,cAAc,QAC3CS,MACAD,oBAAoBE,YAAYD,YAE9BE,aAAeH,oBAAoBI,UAEnCC,YAAc,IAAIC,mBAAU,CAC9BC,UAAW,+CACXC,KAAM,CAACC,KAAM7B,cAAe8B,OAAQ7B,SAAUC,IAAKA,KACnD6B,YAAa,CAACC,MAAOT,gBAGzBxB,OAAS0B,YAETA,YAAYQ,iBAAiBR,YAAYS,OAAOC,QAAQ,eAEhDC,YAAcC,KAAKC,KAA0B,IAArBnC,OAAOoC,aAC/BC,WAAaH,KAAKC,KAAyB,IAApBnC,OAAOsC,YAClCD,WAAaA,WAAa,KAAO,KAAOA,WACjBf,YAAYiB,MAAMC,UAAU,GAAGC,SAAS,GAChDC,aAAa,QACxB,UAAYL,WACZ,iBAAmBA,WACnB,cAAgBJ,YAChB,kBAAoBA,YAAc,UAI1CX,YAAYqB,SAIpBC,SAASd,iBAAiB,SAAS,SAAS5B,iGAClC2C,QAAU3C,EAAEC,mCACd0C,QAAQC,4DAAWC,SAAS,4CAC7BF,QAAQG,cAAcF,4CAAtBG,sBAAiCF,SAAS,0CAC1CF,QAAQC,0CAARI,oBAAmBH,SAAS,qDAC5BF,QAAQG,cAAcF,6CAAtBK,uBAAiCJ,SAAS,wBACzC7C,EAAEI,gCAeqB8C,SAAUvD,cAAeC,SAAUC,WAC5DsD,WAAa,CAAC3B,KAAM7B,cAAe8B,OAAQ7B,SAAUC,IAAKA,IAAKqD,SAAUA,UACzEE,iBAAmBC,MAAMC,UAAUH,YACnCI,YAAc7D,OAAO8D,QAAQJ,wBAC7B1D,OAAO2C,MAAMoB,eAAeF,aAjB1BG,CADWC,SAAShB,QAAQrC,QAAQ,iBAAiBE,aAAa,kBACpCb,cAAeC,SAAUC"}