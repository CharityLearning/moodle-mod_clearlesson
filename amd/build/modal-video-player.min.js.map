{"version":3,"file":"modal-video-player.min.js","sources":["../src/modal-video-player.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A set of functions to be added to charts tab load-tabs.js.\n * Most of these functions enable modal forms for the adding/deleting of charts or editing existing charts.\n *\n * @module     mod_clearlesson/modal-resource-browser\n * @copyright  2024 Dan Watkins <dwatkins@charitylearning.org>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      2.9\n */\n\nimport ModalSaveCancel from 'core/modal_save_cancel';\nimport Templates from 'core/templates';\nimport {get_string as getString} from 'core/str';\nimport * as Utils from './utils';\n\n// eslint-disable-next-line no-unused-vars\nvar modalVideoPlayer;\n\nexport const init = () => {\n    document.addEventListener('click', function(e) {\n        var element;\n        if (e.target?.classList?.contains('play-icon')) {\n            element = e.target;\n        } else if (e.target?.parentElement.classList?.contains('play-icon')) {\n            element = e.target.parentElement;\n        }\n\n        if (element) {\n            e.preventDefault();\n            var name;\n            if (element.closest('.menu-item-card')) {\n                name = element.closest('.menu-item-card').querySelector('.card-title').innerText;\n            } else {\n                name = element.closest('.video-card-wrapper').querySelector('.card-title').innerText;\n            }\n            const src = element.getAttribute('data-src');\n            const externalref = element.getAttribute('data-externalref');\n            openVideoPlayer(externalref, name, src);\n        }\n    });\n};\n\n/**\n * Open the video player modal.\n *\n * @param {string} externalref\n * @param {string} name\n * @param {string} src\n */\nasync function openVideoPlayer(externalref, name, src) {\n    const {html, js} = await Templates.renderForPromise('mod_clearlesson/elements/video_iframe', {\n        externalref: externalref,\n        src: src,\n        name: name,\n    });\n\n    const videoPlayer = await ModalSaveCancel.create({\n        title: getString('videoplayer', 'mod_clearlesson'),\n        body: html,\n        large: true,\n        show: true,\n    });\n\n    Templates.runTemplateJS(js);\n\n    modalVideoPlayer = videoPlayer;\n    const backString = await getString('back');\n    const selectVideoString = await getString('selectvideo', 'mod_clearlesson');\n    const modalRootInner = modalVideoPlayer.getRoot()[0].children[0];\n    Utils.waitForElement('.modal-footer button.btn-secondary', modalRootInner, function() {\n        const cancelButton = modalRootInner.querySelector('.modal-footer button.btn-secondary');\n        cancelButton.innerHTML = backString;\n    });\n    Utils.waitForElement('.modal-footer button.btn-primary', modalRootInner, function() {\n        const saveButton = modalRootInner.querySelector('.modal-footer button.btn-primary');\n        saveButton.innerHTML = selectVideoString;\n        saveButton.setAttribute('data-action', 'select');\n        saveButton.setAttribute('data-type', 'play');\n        saveButton.setAttribute('data-externalref', externalref);\n    });\n\n    videoPlayer.show();\n}"],"names":["modalVideoPlayer","document","addEventListener","e","element","target","_e$target","classList","_e$target$classList","contains","_e$target2","parentElement","_e$target2$parentElem","name","preventDefault","closest","querySelector","innerText","src","getAttribute","externalref","html","js","Templates","renderForPromise","videoPlayer","ModalSaveCancel","create","title","body","large","show","runTemplateJS","backString","selectVideoString","modalRootInner","getRoot","children","Utils","waitForElement","innerHTML","saveButton","setAttribute","openVideoPlayer"],"mappings":";;;;;;;;;SA+BIA,k3BAEgB,KAChBC,SAASC,iBAAiB,SAAS,SAASC,sEACpCC,6BACAD,EAAEE,yDAAFC,UAAUC,0CAAVC,oBAAqBC,SAAS,aAC9BL,QAAUD,EAAEE,0BACLF,EAAEE,4DAAFK,WAAUC,cAAcJ,4CAAxBK,sBAAmCH,SAAS,eACnDL,QAAUD,EAAEE,OAAOM,eAGnBP,QAAS,KAELS,KADJV,EAAEW,iBAGED,KADAT,QAAQW,QAAQ,mBACTX,QAAQW,QAAQ,mBAAmBC,cAAc,eAAeC,UAEhEb,QAAQW,QAAQ,uBAAuBC,cAAc,eAAeC,gBAEzEC,IAAMd,QAAQe,aAAa,4BAcdC,YAAaP,KAAMK,WACxCG,KAACA,KAADC,GAAOA,UAAYC,mBAAUC,iBAAiB,wCAAyC,CACzFJ,YAAaA,YACbF,IAAKA,IACLL,KAAMA,OAGJY,kBAAoBC,2BAAgBC,OAAO,CAC7CC,OAAO,mBAAU,cAAe,mBAChCC,KAAMR,KACNS,OAAO,EACPC,MAAM,uBAGAC,cAAcV,IAExBtB,iBAAmByB,kBACbQ,iBAAmB,mBAAU,QAC7BC,wBAA0B,mBAAU,cAAe,mBACnDC,eAAiBnC,iBAAiBoC,UAAU,GAAGC,SAAS,GAC9DC,MAAMC,eAAe,qCAAsCJ,gBAAgB,WAClDA,eAAenB,cAAc,sCACrCwB,UAAYP,cAE7BK,MAAMC,eAAe,mCAAoCJ,gBAAgB,iBAC/DM,WAAaN,eAAenB,cAAc,oCAChDyB,WAAWD,UAAYN,kBACvBO,WAAWC,aAAa,cAAe,UACvCD,WAAWC,aAAa,YAAa,QACrCD,WAAWC,aAAa,mBAAoBtB,gBAGhDK,YAAYM,OA5CJY,CADoBvC,QAAQe,aAAa,oBACZN,KAAMK"}