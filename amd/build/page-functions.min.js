define("mod_clearlesson/page-functions",["exports","./utils","./progress-tracker","core/str","core_form/modalform"],(function(_exports,Utils,progressTracker,_str,_modalform){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}
/**
   * A set of functions to be used in bot course-page.js and module-page.js
   *
   * @module     mod_clearlesson/page-functions
   * @copyright  2024 Dan Watkins <dwatkins@charitylearning.org>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   * @since      2.9
   */function updateCompletionStatusIfIncorrect(completionInfoElement,pageClearlessonElement){var moodleCompleted,ruleCheckElement;if(completionInfoElement){if("course"===window.pageType&&(ruleCheckElement=completionInfoElement.nextElementSibling,moodleCompleted=!!completionInfoElement.classList.contains("btn-success")),"activity"===window.pageType){ruleCheckElement=completionInfoElement,moodleCompleted=!0;for(const condition of completionInfoElement.children)if(!condition.classList.contains("alert-success")){moodleCompleted=!1;break}}Utils.waitForElement(".incourse",pageClearlessonElement,(async function(){if("1"==pageClearlessonElement.querySelector(".incourse").getAttribute("data-watchedall")&&(window.viewedStatus="watched",window.updateProgress=!1,!moodleCompleted)){const watchdAllRuleString=await(0,_str.get_string)("watchedallrule","mod_clearlesson");ruleCheckElement.outerHTML.includes(watchdAllRuleString)&&(window.currentTime=0,window.extref="",await progressTracker.updateProgressAndActivity())}}))}}function setModalButtons(modalRootInner,backString){Utils.waitForElement(".modal-footer button.btn-primary",modalRootInner,(async function(){modalRootInner.querySelector(".modal-footer button.btn-primary").classList.add("d-none");modalRootInner.querySelector(".modal-footer button.btn-secondary").innerHTML=backString}))}function setModalFullscreen(modalRootInner){let modalHeight=Math.ceil(.94*window.innerHeight),modalWidth=Math.ceil(.94*window.innerWidth);modalWidth=modalWidth>1800?1800:modalWidth,modalRootInner.setAttribute("style","width: "+modalWidth+"px;max-width: "+modalWidth+"px;height: "+modalHeight+"px;max-height: "+modalHeight+"px;")}function setWindowWatched(){const watchedCheck=document.querySelector(".incourse-player .player-column .watched-check");window.updateProgress=null==watchedCheck?void 0:watchedCheck.classList.contains("notwatched")}function setModalBodyGrey(modalRootInner){modalRootInner.querySelector(".modal-body").classList.add("mod-clearlesson-backgrounddgrey")}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.openNewMenuModal=async function(e,url,firstLoad,completionDropdown,backString){var newMenuModal;const menuItem=e.target.closest(".menu-item"),externalRef=menuItem.getAttribute("data-externalref"),instanceName=menuItem.querySelector(".menu-item-title > .searchable").innerHTML;window.updateProgress&&await progressTracker.updateProgressAndActivity();return(newMenuModal=new _modalform.default({formClass:"mod_clearlesson\\forms\\incourse_menu_form",args:{cmid:window.cmid,course:window.courseid,url:url,firstload:firstLoad,externalref:externalRef},modalConfig:{title:instanceName}})).addEventListener(newMenuModal.events.LOADED,(function(){const modalRootInner=newMenuModal.modal.getRoot()[0].children[0];setModalBodyGrey(modalRootInner),setModalButtons(modalRootInner,backString),updateCompletionStatusIfIncorrect(completionDropdown,modalRootInner),window.updateProgress=!1})),newMenuModal.show(),newMenuModal},_exports.openPlayerFromMenu=async function(e,url,firstLoad,completionDropdown,backString){var playerModalFromMenu;const elementAncestor=e.target.closest(".menu-item"),instanceName=elementAncestor.querySelector(".menu-item-title > .searchable").innerHTML,externalRef=elementAncestor.getAttribute("data-externalref");window.updateProgress&&await progressTracker.updateProgressAndActivity();return(playerModalFromMenu=new _modalform.default({formClass:"mod_clearlesson\\forms\\incourse_player_form",args:{cmid:window.cmid,course:window.courseid,url:url,firstload:firstLoad,externalref:externalRef},modalConfig:{title:instanceName}})).addEventListener(playerModalFromMenu.events.LOADED,(function(){const modalRootInner=playerModalFromMenu.modal.getRoot()[0].children[0];setModalFullscreen(modalRootInner),setModalBodyGrey(modalRootInner),Utils.waitForElement(".incourse-player",modalRootInner,(async function(){setWindowWatched(),firstLoad=0})),updateCompletionStatusIfIncorrect(completionDropdown,modalRootInner),setModalButtons(modalRootInner,backString)})),playerModalFromMenu.show(),playerModalFromMenu},_exports.setModalBodyGrey=setModalBodyGrey,_exports.setModalButtons=setModalButtons,_exports.setModalFullscreen=setModalFullscreen,_exports.setWindowWatched=setWindowWatched,_exports.updateCompletionStatusIfIncorrect=updateCompletionStatusIfIncorrect,Utils=_interopRequireWildcard(Utils),progressTracker=_interopRequireWildcard(progressTracker),_modalform=(obj=_modalform)&&obj.__esModule?obj:{default:obj}}));

//# sourceMappingURL=page-functions.min.js.map